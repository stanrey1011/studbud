{% extends 'base.html' %}
{% block content %}
<h2>{{ test.name }} - {{ mode|capitalize }} Mode</h2>
<form id="quizForm">
    {% for q in questions %}
    <div class="question mb-4">
        <p>{{ loop.index }}. {{ q.text }}</p>
        {% if q.image %}<img src="{{ url_for('static', filename='uploads/' + q.image) }}" alt="Question image" class="img-fluid mb-3">{% endif %}
        {% if q.type == 'multiple_choice' %}
            {% for opt in json.loads(q.options) %}
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q{{ q.id }}" id="q{{ q.id }}_{{ loop.index }}" value="{{ opt }}">
                <label class="form-check-label" for="q{{ q.id }}_{{ loop.index }}">{{ opt }}</label>
            </div>
            {% endfor %}
        {% endif %}
        {% if mode == 'study' %}
        <div class="answer mt-2" style="display:none;">
            <strong>Correct:</strong> {{ q.correct }}<br>
            <strong>Explanation:</strong> {{ q.explanation }}
        </div>
        <button type="button" class="btn btn-secondary mt-2" onclick="this.previousElementSibling.style.display='block';">Show Answer</button>
        {% endif %}
    </div>
    {% endfor %}
    {% if mode == 'sim' %}
    <button type="button" class="btn btn-primary" onclick="submitQuiz();">Submit Quiz</button>
    {% endif %}
</form>
<script>
function submitQuiz() {
    let answers = {};
    document.querySelectorAll('.question').forEach(q => {
        let id = q.querySelector('input').name.replace('q', '');
        answers[id] = q.querySelector('input:checked')?.value || '';
    });
    fetch(window.location.href, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({answers: answers, score: calculateScore(answers)})  // Implement calculateScore
    }).then(res => res.json()).then(data => alert(data.status));
}
function calculateScore(answers) {
    // Placeholder: compare to correct answers (fetch via hidden fields or API)
    return 0;
}
</script>
{% endblock %}