{% extends "base.html" %}  {# Adjust if no base.html #}
{% block content %}
<h1>{{ test.name }} - Simulation Mode</h1>
<h2>Question {{ current }} of {{ total }}</h2>
{% if remaining is not none %}
<div id="timer" style="font-weight: bold; color: red;">Time remaining: <span id="countdown"></span></div>
{% else %}
<div id="timer">Unlimited time</div>  {# Optional: Show if no limit #}
{% endif %}
{% if question.image %}
<img src="{{ url_for('static', filename='uploads/' + question.image) }}" alt="Topology" style="max-width: 100%;">
{% endif %}
<p>{{ question.text }}</p>
<form method="POST">
    <input type="hidden" name="question_id" value="{{ question.id }}">
    {% if question.type == 'mcq' %}
    {% for option in options %}
    <label>
        <input type="radio" name="answer" value="{{ option }}" {% if selected == option %}checked{% endif %}>
        {{ option }}
    </label><br>
    {% endfor %}
    {% elif question.type == 'tf' %}
    <label><input type="radio" name="answer" value="True" {% if selected == 'True' %}checked{% endif %}> True</label><br>
    <label><input type="radio" name="answer" value="False" {% if selected == 'False' %}checked{% endif %}> False</label><br>
    {% elif question.type == 'flashcard' %}
    <p>Answer: <input type="text" name="answer" value="{{ selected or '' }}"></p>
    {% endif %}
    <button type="submit" name="prev" {% if current == 1 %}disabled{% endif %}>Previous</button>
    {% if current < total %}
    <button type="submit" name="next">Next</button>
    {% else %}
    <button type="submit" name="submit">Submit</button>
    {% endif %}
</form>
{% if remaining is not none %}
<script>
    let remaining = {{ remaining | int }};
    const countdown = document.getElementById('countdown');
    const form = document.querySelector('form');
    const interval = setInterval(() => {
        remaining--;
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;
        countdown.textContent = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        if (remaining <= 0) {
            clearInterval(interval);
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'submit';
            hiddenInput.value = 'true';
            form.appendChild(hiddenInput);
            form.submit();  // Auto-submit on timeout
        }
    }, 1000);
</script>
{% endif %}
{% endblock %}